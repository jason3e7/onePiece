<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="css/bootstrap.min.css">

  <title>one piece</title>  
</head>

<body>
<div class="jumbotron">
  <div class="container">
    <h1 class="display-3">All in One</h1>
  </div>
</div>
<div class="container" id="files">
  <div class="input-group mb-3">
    <input class="fuzzy-search form-control"  placeholder="Search" />
  </div>
  <table class="table">
    <thead>
      <tr>
        <th scope="col" class="sort" data-sort="time">Modify Time</th>
        <th scope="col" class="sort" data-sort="rating">Rating</th>
        <th scope="col" class="sort" data-sort="ftype">File Type</th>
        <th scope="col" class="sort" data-sort="tags">Tags</th>
        <th scope="col" class="sort" data-sort="description">Description</th>
      </tr>
    </thead>
    <tbody class="list">
    </tbody>
  </table>
</div>

<script src="js/list.js"></script>
<script src="js/jquery-3.3.1.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script>
var values = [
  {
    mtime: 20141203,
    rating: 20,
    ftype: "link",
    tags: "#life",
    description: '<a href="https://www.google.com/">google<a>, this is google.'
  },
  {
    mtime: 20171203,
    rating: 1,
    ftype: "link",
    tags: "#info",
    description: '<a href="https://www.facebook.com/">facebook<a>, this is facebook.'
  },
  {
    mtime: 20181103,
    rating: 99,
    ftype: "link",
    tags: "#game, #time",
    description: '<a href="https://www.youtube.com/">youtube<a>, this is youtube.'
  },
  {
    mtime: 20181204,
    rating: 80,
    ftype: "link",
    tags: "#game",
    description: '<a href="https://www.github.com/">github<a>, this is github.'
  }
];

function loadFile(filepath, cbFunction) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      cbFunction(this);
    }
  };
  xhttp.open("GET", filepath, true);
  xhttp.send();
};

function parseMD(text) {
  var lines = text.split('\n');
  for(var i = 0; i < lines.length; i+=2){
    var element = new Object();
    
    element.mtime = lines[i].match(/\\#mtime:(\w*)/is)[1];
    element.rating = lines[i].match(/\\#rating:(\w*)/is)[1];
    element.ftype = lines[i].match(/\\#type:(\w*)/is)[1];
    element.tags = lines[i].match(/\\#(\w*)[,\.]/gis).join(" ").replace(/\\/g, "")
    link = lines[i].match(/\[([^\[]+)\]\(([^\)]+)\)/);
    element.description = "<a href='" + link[2] + "'>" + link[1] + "</a>";
    element.description += lines[i + 1].match(/  \* (.*)/is)[1];

    values.push(element)
  }
}


loadFile("index.md", function(xhttp){
  parseMD(xhttp.responseText);

  var options = {
  valueNames: [ 'mtime', 'rating', 'ftype', 'tags', 'description' ],
  item: '<tr><td class="mtime"></td><td class="rating"></td><td class="ftype"></td><td class="tags"></td><td class="description"></td></tr>'
  };
  var fileList = new List('files', options, values);
});

</script>

</body>
</html>
